<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Jquery 라이브러리 로드 -->
    <script src="http://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
        $(document).ready(
            function(){
                // 게임의 수, 승률 변수를 생성
                let game_cnt = 0
                let win_cnt = 0
                let lose_cnt = 0
                // id가 'radio_button' 태그를 선택하여 클릭이 발생할 때
                $('#radio_button').click(
                    function(){
                        // input 태그 중 name의 값이 'g1' 태그를 선택
                        // 체크가 되어있는 값을 변수에 저장
                        let selected = $('input[name="g1"]:checked').val()
                        // 확인 작업 (팝업 창)
                        //alert(selected)
                        // 서버에게 데이터를 보낸다
                        $.ajax(
                            // dict 형태의 데이터로 주소, 방식, 받아오는 데이터의 타입, 데이터
                            {
                                url : "/game_result",
                                method : 'post',
                                type : 'json',
                                data : {
                                    'user' : selected
                                }
                            }
                        )
                        .then(
                            function(res){
                                // res : 서버가 보낸 데이터
                                //alert(res['result'])
                                // 유저가 낸 데이터와 서버가 낸 데이터, 결과를 태그에 추가
                                // id가 'game_result'인 태그를 선택해서 html 태그를 추가
                                // 게임이 무승부가 아닌 경우? -> game_cnt에 1을 추가
                                // res['result']가 "축하방구"인 경우? -> win_cnt 1을 추가
                                if (res['result']=='축하방구'){
                                    game_cnt += 1
                                    win_cnt += 1
                                }else if(res['result']=='바보 같은 놈'){
                                    game_cnt += 1
                                    lose_cnt += 1
                                }
                                let win_rate = '-'
                                // 승률 계산? -> game_cnt가 0이 아닌 경우에만 승률 계산
                                if (game_cnt != 0){
                                    win_rate = (win_cnt / game_cnt)*100
                                }
                                $('#game_result').append(
                                    `
                                        <p>
                                            유저 : ${res['user']},
                                            컴퓨터 : ${res['server']},
                                            결과 : ${res['result']},
                                            승률 : ${win_rate}% ${game_cnt}전 ${win_cnt}승 ${lose_cnt}패
                                        </p>
                                    `
                                )
                            }
                        )
                    }
                )
            }
        )
    </script>
    <script>
        // JS 함수 생성
        function game_link(){
            // input태그 중 name이 'g3'인 태그 중 
            // 선택이 된 태그의 value를 추출하여 변수에 저장
            let _user = $('input[name="g3"]:checked').val()
            // 특정 주소로 이동
            let url= "/game_result2?g2="+_user
            // 현재창 주소를 이동
            //window.location.href = url
            // 새로운 창을 생성하여 주소로 요청
            window.open(url)
        }
    </script>
</head>
<body>
    <h1>가위 바위 보 게임</h1>
    <!-- 비동기 방식 -->
    <h3>비동기 방식</h3>
    <!-- 가위, 바위, 보를 선택하는 버튼 생성 -->
    <!-- case1 radio button -->
    <input type="radio" name="g1" id="g1_1" value="가위">
    <label for="g1_1">가위</label>
    <input type="radio" name="g1" id="g1_2" value="바위">
    <label for="g1_1">바위</label>
    <input type="radio" name="g1" id="g1_3" value="보">
    <label for="g1_1">보</label>
    <br>
    <button id="radio_button">게임 시작</button>
    <!-- 게임의 결과를 출력하는 공간 -->
    <div id="game_result">

    </div>

    <h3>동기 방식</h3>
    <form action="/game_result2" method="get">
        <!-- 유저가 선택할 수 있는 공간 -->
        <input type="radio"  name="g2" id="g2_1" value="가위">
        <label for="g2_1">가위</label>
        <input type="radio" name="g2" id="g2_2" value="바위">
        <label for="g2_2">바위</label>
        <input type="radio" name="g2" id="g2_3" value="보">
        <label for="g2_3">보</label>
        <!-- 제출 버튼 생성 -->
        <input type="submit" value="게임시작">
    </form>
    <h3>하이퍼링크를 이용한 게임</h3>
    <input type="radio"  name="g3" id="g3_1" value="가위">
        <label for="g3_1">가위</label>
        <input type="radio" name="g3" id="g3_2" value="바위">
        <label for="g3_2">바위</label>
        <input type="radio" name="g3" id="g3_3" value="보">
        <label for="g3_3">보</label>
        <!-- 버튼 생성 JS코드를 실행, 함수 호출 -->
        <button onclick="game_link()">게임 시작</button>
</body>
</html>